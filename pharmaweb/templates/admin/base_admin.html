<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>{% block title %}Admin - PharmaGest{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}" />

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet" />

    <!-- Core theme CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/admin.css') }}" rel="stylesheet" />

    {% block css %}{% endblock %}
</head>

<body class="sb-nav-fixed">
    <!-- Navigation -->
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <!-- Brand -->
        <a class="navbar-brand ps-3" href="{{ url_for('views.admin_dashboard') }}">
            <i class="fas fa-prescription-bottle-alt me-2"></i> PharmaGest
        </a>

        <!-- Sidebar Toggle -->
        <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Navbar -->
        <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    <i class="fas fa-user fa-fw"></i> {{ current_user.prenom }}
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                    <li><a class="dropdown-item" href="{{ url_for('views.profile') }}">Profil</a></li>
                    <li>
                        <hr class="dropdown-divider" />
                    </li>
                    <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Déconnexion</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <!-- Layout -->
    <div id="layoutSidenav">
        <!-- Sidebar -->
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Principal</div>
                        <a class="nav-link active" href="{{ url_for('views.admin_dashboard') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Tableau de bord
                        </a>

                        <div class="sb-sidenav-menu-heading">Gestion</div>
                        <a class="nav-link" href="{{ url_for('views.gestion_medicaments') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-pills"></i></div>
                            Médicaments
                        </a>
                        <a class="nav-link" href="{{ url_for('views.gestion_ventes') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-receipt"></i></div>
                            Ventes
                        </a>
                        <a class="nav-link" href="{{ url_for('views.gestion_ventes') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-boxes"></i></div>
                            Stocks
                        </a>
                        <a class="nav-link" href="{{ url_for('views.alertes') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-exclamation-circle"></i></div>
                            Alertes
                        </a>

                        <div class="sb-sidenav-menu-heading">Administration</div>
                        <a class="nav-link" href="{{ url_for('views.gestion_utilisateurs') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-users"></i></div>
                            Utilisateurs
                        </a>
                        <a class="nav-link" href="{{ url_for('views.parametres_pharmacie') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-cog"></i></div>
                            Paramètres
                        </a>
                    </div>
                </div>
                <div class="sb-sidenav-footer">
                    <div class="small">Connecté en tant que:</div>
                    {{ current_user.role|capitalize }}
                </div>
            </nav>
        </div>

        <!-- Main content -->
        <div id="layoutSidenav_content">
            <main>
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show m-4">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
                {% endif %}
                {% endwith %}

                {% block content %}{% endblock %}
            </main>

            <!-- Footer -->
            <footer class="py-4 bg-light mt-auto">
                <div class="container-fluid px-4">
                    <div class="d-flex align-items-center justify-content-between small">
                        <div class="text-muted">Copyright &copy; PharmaGest 2023</div>
                        <div>
                            <a href="#">Politique de confidentialité</a>
                            &middot;
                            <a href="#">Conditions d'utilisation</a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
    {% block scripts %}
<script>
    // Graphique des ventes
    const ventesCtx = document.getElementById('ventesChart');
    if (ventesCtx) {
        const ventesChart = new Chart(ventesCtx, {
            type: 'line',
            data: {
                labels: {{ dates_7jours|default([])|tojson|safe }},
                datasets: [{
                    label: 'Montant des ventes (€)',
                    data: {{ montants_7jours|default([])|tojson|safe }},
                    backgroundColor: 'rgba(13, 110, 253, 0.2)',
                    borderColor: 'rgba(13, 110, 253, 1)',
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Graphique des médicaments
    const medsCtx = document.getElementById('topMedicamentsChart');
    if (medsCtx) {
        const medsChart = new Chart(medsCtx, {
            type: 'bar',
            data: {
                labels: {{ top_medicaments_noms|default([])|tojson|safe }},
                datasets: [{
                    label: 'Quantités vendues',
                    data: {{ top_medicaments_qtes|default([])|tojson|safe }},
                    backgroundColor: 'rgba(52, 152, 219, 0.7)'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
</script>
{% endblock %}
</body>

</html>